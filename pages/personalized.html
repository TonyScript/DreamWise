<!DOCTYPE html><html lang="en"><head>
    <!-- 第三方资源预连接 -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NVT75WW9');</script>
    <!-- End Google Tag Manager -->

    <!-- Google tag (gtag.js) -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4K73RJPLKS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4K73RJPLKS');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Personalized Dream Analysis - Custom Dream Interpretation | DreamWise</title>
    <meta name="description" content="Get personalized dream analysis and custom dream interpretation tailored to your spiritual background and life circumstances. Multi-faith dream guidance.">
    <meta name="keywords" content="personalized dream analysis, custom dream interpretation, dream meaning, spiritual guidance, multi-faith dream analysis">
    <meta name="author" content="DreamWise Team">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Personalized Dream Analysis - Custom Dream Interpretation">
    <meta property="og:description" content="Get personalized dream analysis and custom dream interpretation tailored to your spiritual background and life circumstances.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dreamwise.charitydoing.com/personalized.html">
    <meta property="og:image" content="/assets/images/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://dreamwise.charitydoing.com/personalized.html">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'glass': 'rgba(255, 255, 255, 0.1)',
                    }
                }
            }
        }
    </script>

    <!-- Vince -->
    <script defer="" data-domain="dreamwise.charitydoing.com" src="https://vince.charitydoing.com/js/script.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" onload="this.onload=null;this.rel='stylesheet'" as="style"></noscript>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="preload" onload="this.onload=null;this.rel='stylesheet'" as="style">

    <!-- Custom CSS -->
    <link rel="preload" href="assets/css/main.min.css" onload="this.onload=null;this.rel='stylesheet'" as="style">
    <link rel="preload" href="assets/css/image-optimization.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="preload" href="assets/css/image-optimization.css" onload="this.onload=null;this.rel='stylesheet'" as="style"></noscript>

    <style>
/* 关键渲染路径CSS - 防止布局闪烁 */
body {
  opacity: 0;
  transition: opacity 0.3s ease;
  font-family: 'Inter', sans-serif; 
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); 
  color: #ffffff; 
  line-height: 1.6; 
  margin: 0; 
  padding: 0; 
  min-height: 100vh;
}

body.loaded {
  opacity: 1;
}

.glass-card { 
  background: rgba(255, 255, 255, 0.05); 
  backdrop-filter: blur(15px); 
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.1); 
  border-radius: 20px; 
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

nav { 
  position: fixed; 
  top: 0; 
  left: 0; 
  right: 0; 
  z-index: 50; 
}

.container { 
  max-width: 1200px; 
  margin: 0 auto; 
  padding: 0 1.5rem; 
}

.hidden { display: none; }

/* 移动端优化 */
@media (max-width: 768px) {
  .md\:hidden { display: none; }
  .md\:flex { display: flex; }
  .container { padding: 0 1rem; }
}

        /* 关键CSS内联 */
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); 
            color: #ffffff; 
            line-height: 1.6; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh;
        }
        
        .glass-card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(15px); 
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 20px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-text { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        
        .hover-scale { 
            transition: transform 0.3s ease; 
            will-change: transform; 
        }
        
        .hover-scale:hover {
            transform: translateY(-5px);
        }

        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-select option {
            background: #1a1a2e;
            color: white;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-indicator.active {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            border-color: transparent;
        }

        .step-indicator.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: transparent;
        }

        .analysis-result {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .faith-perspective {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .faith-perspective.christian { border-left-color: #3b82f6; }
        .faith-perspective.islamic { border-left-color: #10b981; }
        .faith-perspective.buddhist { border-left-color: #f97316; }
        .faith-perspective.hindu { border-left-color: #8b5cf6; }
        .faith-perspective.jewish { border-left-color: #fbbf24; }
    </style>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NVT75WW9" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Skip to Content Link for Accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>

    <!-- Navigation Header -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass-card mx-4 mt-4 rounded-2xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center space-x-3 hover:opacity-80 transition-opacity duration-300 cursor-pointer">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                        <i class="fas fa-moon text-white text-lg"></i>
                    </div>
                    <span class="text-xl font-bold gradient-text">DreamWise</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium">Home</a>
                    <a href="pages/browse.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium">Browse A-Z</a>
                    <a href="pages/categories.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium">Categories</a>
                    <a href="pages/insights.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium">Insights</a>
                    <a href="pages/about.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium">About</a>
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden mobile-menu-toggle text-white hover:text-purple-300 transition-colors duration-300">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>

            <!-- Mobile Navigation Menu -->
            <div class="mobile-menu hidden md:hidden mt-4 pt-4 border-t border-white/20">
                <div class="flex flex-col space-y-3">
                    <a href="index.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium py-2">Home</a>
                    <a href="pages/browse.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium py-2">Browse A-Z</a>
                    <a href="pages/categories.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium py-2">Categories</a>
                    <a href="pages/insights.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium py-2">Insights</a>
                    <a href="pages/about.html" class="text-white hover:text-purple-300 transition-colors duration-300 font-medium py-2">About</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="pt-32 pb-16">
        <div class="container mx-auto px-6">
            <!-- Hero Section -->
            <section class="text-center mb-16">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                    <i class="fas fa-user-circle text-white text-3xl"></i>
                </div>
                <h1 class="text-4xl md:text-6xl font-bold mb-6">
                    <span class="gradient-text">Personalized</span> Dream Analysis
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    Get custom dream interpretations tailored to your spiritual background, life circumstances, and personal symbolism
                </p>
            </section>

            <!-- Step Indicator -->
            <section class="mb-12">
                <div class="flex justify-center items-center space-x-8 max-w-2xl mx-auto">
                    <div class="flex items-center">
                        <div class="step-indicator active" id="step1-indicator">1</div>
                        <span class="ml-3 text-sm font-medium">Dream Details</span>
                    </div>
                    <div class="flex-1 h-px bg-white/20"></div>
                    <div class="flex items-center">
                        <div class="step-indicator" id="step2-indicator">2</div>
                        <span class="ml-3 text-sm font-medium">Personal Context</span>
                    </div>
                    <div class="flex-1 h-px bg-white/20"></div>
                    <div class="flex items-center">
                        <div class="step-indicator" id="step3-indicator">3</div>
                        <span class="ml-3 text-sm font-medium">Analysis</span>
                    </div>
                </div>
            </section>

            <!-- Dream Analysis Form -->
            <section class="max-w-4xl mx-auto">
                <div class="glass-card p-8 md:p-12">
                    <form id="dreamAnalysisForm">
                        <!-- Step 1: Dream Details -->
                        <div id="step1" class="step-content">
                            <h2 class="text-3xl font-bold mb-8 text-center">Tell Us About Your Dream</h2>
                            
                            <div class="space-y-6">
                                <div>
                                    <label for="dreamDescription" class="block text-lg font-semibold mb-3">Dream Description</label>
                                    <textarea id="dreamDescription" name="dreamDescription" rows="6" class="form-input resize-none" placeholder="Describe your dream in as much detail as possible. Include people, places, emotions, colors, and any significant events or symbols you remember..." required=""></textarea>
                                </div>

                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="dreamDate" class="block text-lg font-semibold mb-3">When did you have this dream?</label>
                                        <input type="date" id="dreamDate" name="dreamDate" class="form-input" required="">
                                    </div>
                                    <div>
                                        <label for="dreamTime" class="block text-lg font-semibold mb-3">Approximate time</label>
                                        <select id="dreamTime" name="dreamTime" class="form-select" required="">
                                            <option value="">Select time period</option>
                                            <option value="early-night">Early night (9 PM - 12 AM)</option>
                                            <option value="midnight">Midnight (12 AM - 3 AM)</option>
                                            <option value="pre-dawn">Pre-dawn (3 AM - 6 AM)</option>
                                            <option value="morning">Morning (6 AM - 9 AM)</option>
                                            <option value="unknown">Don't remember</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label for="dreamEmotions" class="block text-lg font-semibold mb-3">How did the dream make you feel?</label>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="peaceful" class="rounded">
                                            <span>Peaceful</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="anxious" class="rounded">
                                            <span>Anxious</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="joyful" class="rounded">
                                            <span>Joyful</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="fearful" class="rounded">
                                            <span>Fearful</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="confused" class="rounded">
                                            <span>Confused</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="hopeful" class="rounded">
                                            <span>Hopeful</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="sad" class="rounded">
                                            <span>Sad</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="dreamEmotions" value="excited" class="rounded">
                                            <span>Excited</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label for="dreamRecurring" class="block text-lg font-semibold mb-3">Is this a recurring dream or similar to previous dreams?</label>
                                    <select id="dreamRecurring" name="dreamRecurring" class="form-select" required="">
                                        <option value="">Select option</option>
                                        <option value="first-time">First time having this dream</option>
                                        <option value="recurring">This dream recurs regularly</option>
                                        <option value="similar">Similar to previous dreams</option>
                                        <option value="variation">Variation of a recurring theme</option>
                                    </select>
                                </div>
                            </div>

                            <div class="flex justify-end mt-8">
                                <button type="button" onclick="nextStep(2)" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold rounded-full transition-all duration-300">
                                    Next Step <i class="fas fa-arrow-right ml-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Personal Context -->
                        <div id="step2" class="step-content hidden">
                            <h2 class="text-3xl font-bold mb-8 text-center">Personal Context</h2>
                            
                            <div class="space-y-6">
                                <div>
                                    <label for="spiritualBackground" class="block text-lg font-semibold mb-3">Spiritual/Religious Background</label>
                                    <select id="spiritualBackground" name="spiritualBackground" class="form-select" required="">
                                        <option value="">Select your background</option>
                                        <option value="christian">Christian</option>
                                        <option value="islamic">Islamic</option>
                                        <option value="buddhist">Buddhist</option>
                                        <option value="hindu">Hindu</option>
                                        <option value="jewish">Jewish</option>
                                        <option value="multi-faith">Multi-faith/Eclectic</option>
                                        <option value="spiritual">Spiritual but not religious</option>
                                        <option value="secular">Secular/Non-religious</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="lifeStage" class="block text-lg font-semibold mb-3">Current Life Stage</label>
                                    <select id="lifeStage" name="lifeStage" class="form-select" required="">
                                        <option value="">Select life stage</option>
                                        <option value="student">Student</option>
                                        <option value="young-adult">Young Adult (20s-30s)</option>
                                        <option value="established-adult">Established Adult (30s-50s)</option>
                                        <option value="mature-adult">Mature Adult (50s+)</option>
                                        <option value="retired">Retired</option>
                                        <option value="transitioning">Life Transition Period</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="currentChallenges" class="block text-lg font-semibold mb-3">Current Life Challenges or Focus Areas (Optional)</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="career" class="rounded">
                                            <span>Career/Work</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="relationships" class="rounded">
                                            <span>Relationships</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="health" class="rounded">
                                            <span>Health</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="spiritual-growth" class="rounded">
                                            <span>Spiritual Growth</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="family" class="rounded">
                                            <span>Family</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="finances" class="rounded">
                                            <span>Finances</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="personal-growth" class="rounded">
                                            <span>Personal Growth</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="currentChallenges" value="life-purpose" class="rounded">
                                            <span>Life Purpose</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label for="interpretationPreference" class="block text-lg font-semibold mb-3">Which perspectives would you like included in your analysis?</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="christian" class="rounded">
                                            <span>Christian Perspective</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="islamic" class="rounded">
                                            <span>Islamic Perspective</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="buddhist" class="rounded">
                                            <span>Buddhist Perspective</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="hindu" class="rounded">
                                            <span>Hindu Perspective</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="jewish" class="rounded">
                                            <span>Jewish Perspective</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" name="interpretationPreference" value="universal" class="rounded">
                                            <span>Universal/Psychological</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label for="additionalContext" class="block text-lg font-semibold mb-3">Additional Context (Optional)</label>
                                    <textarea id="additionalContext" name="additionalContext" rows="4" class="form-input resize-none" placeholder="Any additional information that might help with interpretation, such as recent life events, spiritual practices, or personal concerns..."></textarea>
                                </div>
                            </div>

                            <div class="flex justify-between mt-8">
                                <button type="button" onclick="previousStep(1)" class="px-8 py-3 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-full transition-all duration-300">
                                    <i class="fas fa-arrow-left mr-2"></i> Previous
                                </button>
                                <button type="button" onclick="handleAnalysisRequest()" id="generateAnalysisBtn" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold rounded-full transition-all duration-300">
                                    <span id="analysisButtonText">Generate Analysis</span> <i id="analysisButtonIcon" class="fas fa-magic ml-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Analysis Results -->
                        <div id="step3" class="step-content hidden">
                            <h2 class="text-3xl font-bold mb-8 text-center">Your Personalized Dream Analysis</h2>
                            
                            <div id="analysisResults">
                                <!-- Results will be generated here -->
                            </div>

                            <div class="flex justify-center mt-8">
                                <button type="button" onclick="startOver()" class="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-semibold rounded-full transition-all duration-300">
                                    <i class="fas fa-redo mr-2"></i> Analyze Another Dream
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Features Section -->
            <section class="mt-20">
                <h2 class="text-3xl font-bold mb-12 text-center">Why Choose Personalized Analysis?</h2>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="glass-card hover-scale p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                            <i class="fas fa-user-cog text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">Tailored to You</h3>
                        <p class="text-gray-300">
                            Analysis considers your spiritual background, life stage, and current circumstances for relevant insights.
                        </p>
                    </div>

                    <div class="glass-card hover-scale p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                            <i class="fas fa-globe text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">Multi-Faith Perspectives</h3>
                        <p class="text-gray-300">
                            Choose from Christian, Islamic, Buddhist, Hindu, Jewish, and universal interpretations.
                        </p>
                    </div>

                    <div class="glass-card hover-scale p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">Actionable Insights</h3>
                        <p class="text-gray-300">
                            Receive practical guidance and spiritual insights you can apply to your daily life and growth.
                        </p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer Container - Loaded dynamically -->
    <div id="footer-container"></div>

    <!-- JavaScript -->
    <script src="assets/js/main.min.js" defer=""></script>
    <script src="assets/js/components.js" defer=""></script>

    <script>
        // Form navigation functions
        function nextStep(stepNumber) {
            // Validate current step
            if (stepNumber === 2) {
                const dreamDescription = document.getElementById('dreamDescription').value;
                const dreamDate = document.getElementById('dreamDate').value;
                const dreamTime = document.getElementById('dreamTime').value;
                const dreamRecurring = document.getElementById('dreamRecurring').value;

                if (!dreamDescription || !dreamDate || !dreamTime || !dreamRecurring) {
                    alert('Please fill in all required fields before proceeding.');
                    return;
                }
            }

            // Hide current step
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            
            // Show next step
            document.getElementById(`step${stepNumber}`).classList.remove('hidden');
            
            // Update step indicators
            updateStepIndicators(stepNumber);
        }

        function previousStep(stepNumber) {
            // Hide current step
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            
            // Show previous step
            document.getElementById(`step${stepNumber}`).classList.remove('hidden');
            
            // Update step indicators
            updateStepIndicators(stepNumber);
        }

        function updateStepIndicators(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                indicator.classList.remove('active', 'completed');
                
                if (i < currentStep) {
                    indicator.classList.add('completed');
                } else if (i === currentStep) {
                    indicator.classList.add('active');
                }
            }
        }

        // 处理分析请求 - 检查登录状态
        function handleAnalysisRequest() {
            // 检查是否已登录
            if (!isUserAuthenticated()) {
                showLoginRequired();
                return;
            }
            
            generateAnalysis();
        }
        
        // 检查用户认证状态
        function isUserAuthenticated() {
            const token = localStorage.getItem('dreamwise_token');
            const user = localStorage.getItem('dreamwise_user');
            
            console.log('Checking authentication - token:', !!token, 'user:', !!user);
            
            if (!token || !user) {
                console.log('No token or user found');
                return false;
            }
            
            try {
                // 检查token是否过期
                const payload = JSON.parse(atob(token.split('.')[1]));
                const bufferTime = 5 * 60 * 1000; // 5分钟缓冲
                const isValid = Date.now() < (payload.exp * 1000 - bufferTime);
                console.log('Token validation result:', isValid);
                return isValid;
            } catch (error) {
                console.log('Token parsing error:', error);
                return false;
            }
        }
        
        // 显示登录要求
        function showLoginRequired() {
            const analysisResults = document.getElementById('analysisResults');
            analysisResults.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-sign-in-alt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-4">Sign In Required</h3>
                    <p class="text-gray-300 mb-6 max-w-md mx-auto">
                        Please sign in to generate your personalized dream analysis. This feature requires an account to provide tailored interpretations.
                    </p>
                    <div class="space-y-3">
                        <button onclick="showLoginModal()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                            Sign In to Continue
                        </button>
                        <button onclick="showRegisterModal()" class="block mx-auto px-6 py-3 border border-white/30 text-white hover:bg-white/10 font-medium rounded-xl transition-all duration-300">
                            Create Free Account
                        </button>
                        <a href="../index-new.html" class="block text-gray-400 hover:text-white transition-all duration-300">
                            ← Back to Home
                        </a>
                    </div>
                </div>
            `;
            
            // 移动到步骤3显示登录要求
            nextStep(3);
        }
        
        // 显示登录模态框的辅助函数
        function showLoginModal() {
            if (typeof authManager !== 'undefined') {
                authManager.showLoginModal();
            } else {
                // 如果auth.js未加载，跳转到首页
                window.location.href = '../index-new.html';
            }
        }
        
        function showRegisterModal() {
            if (typeof authManager !== 'undefined') {
                authManager.showRegisterModal();
            } else {
                // 如果auth.js未加载，跳转到首页
                window.location.href = '../index-new.html';
            }
        }

        function generateAnalysis() {
            // Validate step 2
            const spiritualBackground = document.getElementById('spiritualBackground').value;
            const lifeStage = document.getElementById('lifeStage').value;
            const interpretationPreferences = document.querySelectorAll('input[name="interpretationPreference"]:checked');

            if (!spiritualBackground || !lifeStage || interpretationPreferences.length === 0) {
                alert('Please fill in all required fields and select at least one interpretation perspective.');
                return;
            }

            // Show loading state
            const analysisResults = document.getElementById('analysisResults');
            analysisResults.innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"></div>
                    <p class="text-lg">Generating your personalized analysis...</p>
                    <p class="text-sm text-gray-400 mt-2">Analyzing your dream with advanced interpretation algorithms...</p>
                </div>
            `;

            // Move to step 3
            nextStep(3);

            // Generate intelligent analysis based on user input
            setTimeout(() => {
                generateIntelligentAnalysis();
            }, 3000);
        }

        function generateIntelligentAnalysis() {
            // 收集所有用户输入
            const dreamData = collectDreamData();
            
            // 生成智能分析
            const analysis = createPersonalizedAnalysis(dreamData);
            
            let analysisHTML = `
                <div class="analysis-result">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-white text-2xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold">Your Personalized Dream Analysis</h3>
                        <p class="text-gray-400 mt-2">Generated based on your spiritual background and personal context</p>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-eye mr-3 text-purple-400"></i>
                            Dream Overview
                        </h4>
                        <div class="bg-white/5 rounded-lg p-6">
                            <p class="text-gray-300 leading-relaxed">
                                ${analysis.overview}
                            </p>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-search mr-3 text-blue-400"></i>
                            Key Symbols & Meanings
                        </h4>
                        <div class="grid md:grid-cols-2 gap-4">
                            ${analysis.symbols}
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-heart mr-3 text-red-400"></i>
                            Emotional Significance
                        </h4>
                        <div class="bg-white/5 rounded-lg p-6">
                            <p class="text-gray-300 leading-relaxed">
                                ${analysis.emotional}
                            </p>
                        </div>
                    </div>
            `;

            // 添加信仰视角
            if (dreamData.interpretationPreferences.length > 0) {
                analysisHTML += `
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-praying-hands mr-3 text-yellow-400"></i>
                            Spiritual Perspectives
                        </h4>
                `;
                
                dreamData.interpretationPreferences.forEach(faith => {
                    analysisHTML += generateIntelligentFaithPerspective(faith, dreamData);
                });
                
                analysisHTML += `</div>`;
            }

            analysisHTML += `
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-compass mr-3 text-green-400"></i>
                            Personal Guidance
                        </h4>
                        <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-lg p-6">
                            <p class="text-gray-300 leading-relaxed mb-4">
                                ${analysis.guidance}
                            </p>
                            <div class="border-t border-white/10 pt-4">
                                <h5 class="font-semibold text-purple-300 mb-2">Recommended Actions:</h5>
                                <ul class="text-sm text-gray-400 space-y-1">
                                    ${analysis.recommendations.map(rec => `<li>• ${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <div class="bg-white/5 rounded-lg p-4 mb-4">
                            <p class="text-sm text-gray-400">
                                <i class="fas fa-sparkles mr-2 text-purple-400"></i>
                                This analysis was generated using advanced interpretation algorithms tailored to your personal context.
                            </p>
                        </div>
                        <button onclick="startOver()" class="px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-medium rounded-xl transition-all duration-300">
                            <i class="fas fa-redo mr-2"></i>
                            Analyze Another Dream
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('analysisResults').innerHTML = analysisHTML;
        }
        
        // 收集所有梦境数据
        function collectDreamData() {
            return {
                description: document.getElementById('dreamDescription').value,
                date: document.getElementById('dreamDate').value,
                time: document.getElementById('dreamTime').value,
                emotions: Array.from(document.querySelectorAll('input[name="dreamEmotions"]:checked')).map(cb => cb.value),
                recurring: document.getElementById('dreamRecurring').value,
                spiritualBackground: document.getElementById('spiritualBackground').value,
                lifeStage: document.getElementById('lifeStage').value,
                currentChallenges: Array.from(document.querySelectorAll('input[name="currentChallenges"]:checked')).map(cb => cb.value),
                interpretationPreferences: Array.from(document.querySelectorAll('input[name="interpretationPreference"]:checked')).map(cb => cb.value),
                additionalContext: document.getElementById('additionalContext').value
            };
        }
        
        // 创建个性化分析
        function createPersonalizedAnalysis(dreamData) {
            const analysis = {
                overview: generateIntelligentOverview(dreamData),
                symbols: generateIntelligentSymbols(dreamData),
                emotional: generateEmotionalAnalysis(dreamData),
                guidance: generatePersonalizedGuidance(dreamData),
                recommendations: generateRecommendations(dreamData)
            };
            
            return analysis;
        }

        function generateFaithPerspective(faith, dreamDescription) {
            const perspectives = {
                christian: {
                    title: 'Christian Perspective',
                    content: 'From a Christian viewpoint, this dream may represent God\'s guidance in your life. The symbols suggest themes of faith, redemption, and divine purpose. Consider praying for discernment and seeking biblical wisdom related to these themes.'
                },
                islamic: {
                    title: 'Islamic Perspective', 
                    content: 'In Islamic tradition, this dream could be a form of divine communication. The elements present may indicate Allah\'s guidance or a call to strengthen your faith. Consider making du\'a and reflecting on relevant Quranic teachings.'
                },
                buddhist: {
                    title: 'Buddhist Perspective',
                    content: 'From a Buddhist understanding, this dream reflects the nature of consciousness and may indicate karmic patterns or spiritual development. The symbols suggest opportunities for mindfulness and compassion practice.'
                },
                hindu: {
                    title: 'Hindu Perspective',
                    content: 'In Hindu tradition, this dream may relate to your dharmic path and spiritual evolution. The symbols could indicate karmic influences or guidance from divine consciousness toward your life purpose.'
                },
                jewish: {
                    title: 'Jewish Perspective',
                    content: 'From a Jewish viewpoint, this dream may contain divine messages or reflect your spiritual journey. The Talmudic tradition suggests seeking wise interpretation and considering how this relates to your relationship with the Divine.'
                },
                universal: {
                    title: 'Universal/Psychological Perspective',
                    content: 'From a universal standpoint, this dream reflects your subconscious processing of life experiences and emotions. The symbols suggest psychological themes of growth, integration, and self-understanding.'
                }
            };

            const perspective = perspectives[faith];
            return `
                <div class="faith-perspective ${faith}">
                    <h4 class="text-lg font-semibold mb-3">${perspective.title}</h4>
                    <p class="text-gray-300">${perspective.content}</p>
                </div>
            `;
        }

        // 生成智能概述
        function generateIntelligentOverview(dreamData) {
            const { description, emotions, spiritualBackground, lifeStage, currentChallenges } = dreamData;
            
            let overview = `Based on your ${spiritualBackground} background and current ${lifeStage} life stage, this dream appears to be `;
            
            // 根据情绪分析梦境性质
            const positiveEmotions = emotions.filter(e => ['peaceful', 'joyful', 'hopeful', 'excited'].includes(e));
            const negativeEmotions = emotions.filter(e => ['anxious', 'fearful', 'confused', 'sad'].includes(e));
            
            if (positiveEmotions.length > negativeEmotions.length) {
                overview += `a positive spiritual message reflecting growth and inner harmony. `;
            } else if (negativeEmotions.length > positiveEmotions.length) {
                overview += `addressing inner concerns and calling for spiritual attention to areas needing healing. `;
            } else {
                overview += `a balanced reflection of your current spiritual and emotional state. `;
            }
            
            // 根据生活挑战添加相关性
            if (currentChallenges.length > 0) {
                const challengeText = currentChallenges.join(', ');
                overview += `The themes present seem particularly relevant to your current focus on ${challengeText}. `;
            }
            
            // 根据梦境描述长度和复杂性
            if (description.length > 200) {
                overview += `The rich detail in your dream suggests deep subconscious processing and significant spiritual communication.`;
            } else {
                overview += `While concise, this dream carries important symbolic meaning for your spiritual journey.`;
            }
            
            return overview;
        }
        
        // 生成智能符号分析
        function generateIntelligentSymbols(dreamData) {
            const { description } = dreamData;
            const text = description.toLowerCase();
            
            const symbolDatabase = {
                water: { meaning: 'Spiritual cleansing, emotional flow, and life transitions', color: 'text-blue-400' },
                flying: { meaning: 'Freedom, spiritual ascension, and transcendence of limitations', color: 'text-sky-400' },
                house: { meaning: 'Inner self, spiritual foundation, and personal security', color: 'text-yellow-400' },
                light: { meaning: 'Divine guidance, enlightenment, and spiritual awakening', color: 'text-yellow-300' },
                darkness: { meaning: 'Unknown aspects, spiritual testing, or need for inner illumination', color: 'text-gray-400' },
                animal: { meaning: 'Instinctual wisdom, spiritual guides, and natural connection', color: 'text-green-400' },
                people: { meaning: 'Relationships, community support, and social spiritual connections', color: 'text-pink-400' },
                journey: { meaning: 'Life path, spiritual pilgrimage, and personal growth process', color: 'text-purple-400' },
                fire: { meaning: 'Spiritual passion, purification, and transformative energy', color: 'text-red-400' },
                tree: { meaning: 'Growth, wisdom, and connection between earth and heaven', color: 'text-green-500' },
                mountain: { meaning: 'Spiritual challenges, higher perspective, and divine connection', color: 'text-gray-500' },
                door: { meaning: 'New opportunities, spiritual transitions, and access to hidden knowledge', color: 'text-brown-400' }
            };
            
            const foundSymbols = Object.keys(symbolDatabase).filter(symbol => {
                return text.includes(symbol) || text.includes(symbol + 's') || 
                       (symbol === 'people' && (text.includes('person') || text.includes('man') || text.includes('woman'))) ||
                       (symbol === 'animal' && (text.includes('dog') || text.includes('cat') || text.includes('bird'))) ||
                       (symbol === 'light' && (text.includes('bright') || text.includes('glow') || text.includes('sun'))) ||
                       (symbol === 'journey' && (text.includes('walking') || text.includes('traveling') || text.includes('path')));
            }).slice(0, 4);
            
            // 如果没找到足够的符号，添加一些通用的
            if (foundSymbols.length < 2) {
                const universalSymbols = ['journey', 'light', 'people'];
                universalSymbols.forEach(symbol => {
                    if (foundSymbols.length < 3 && !foundSymbols.includes(symbol)) {
                        foundSymbols.push(symbol);
                    }
                });
            }
            
            return foundSymbols.map(symbol => {
                const symbolInfo = symbolDatabase[symbol];
                return `
                    <div class="p-4 bg-white/5 rounded-lg border-l-4 border-purple-400">
                        <h5 class="font-semibold ${symbolInfo.color} mb-2 flex items-center">
                            <i class="fas fa-star mr-2"></i>
                            ${symbol.charAt(0).toUpperCase() + symbol.slice(1)}
                        </h5>
                        <p class="text-sm text-gray-300">${symbolInfo.meaning}</p>
                    </div>
                `;
            }).join('');
        }
        
        // 生成情绪分析
        function generateEmotionalAnalysis(dreamData) {
            const { emotions, currentChallenges } = dreamData;
            
            if (emotions.length === 0) {
                return "The emotional tone of this dream suggests a neutral processing state, indicating a time of inner balance and reflection.";
            }
            
            let analysis = "The emotional landscape of your dream reveals ";
            
            const emotionMeanings = {
                peaceful: "inner harmony and spiritual alignment",
                anxious: "areas requiring attention and spiritual grounding",
                joyful: "celebration of spiritual progress and divine connection",
                fearful: "spiritual challenges that call for courage and faith",
                confused: "a need for clarity and spiritual discernment",
                hopeful: "positive spiritual momentum and divine encouragement",
                sad: "emotional processing and the need for spiritual comfort",
                excited: "anticipation of spiritual growth and new opportunities"
            };
            
            const emotionDescriptions = emotions.map(emotion => emotionMeanings[emotion]).join(', ');
            analysis += emotionDescriptions + ". ";
            
            // 连接到生活挑战
            if (currentChallenges.length > 0) {
                analysis += `These emotions appear connected to your current focus on ${currentChallenges.join(' and ')}, suggesting your subconscious is actively processing these areas of your life.`;
            } else {
                analysis += "These emotions indicate your spiritual and emotional state is seeking balance and understanding.";
            }
            
            return analysis;
        }
        
        // 生成个性化指导
        function generatePersonalizedGuidance(dreamData) {
            const { spiritualBackground, lifeStage, currentChallenges, emotions } = dreamData;
            
            let guidance = "";
            
            // 基于信仰背景的指导
            const faithGuidance = {
                christian: "This dream invites you to seek God's guidance through prayer and scripture meditation. ",
                islamic: "Consider making du'a and reflecting on relevant Quranic teachings for deeper understanding. ",
                buddhist: "Practice mindfulness and compassion as you contemplate the deeper meanings revealed. ",
                hindu: "Reflect on your dharmic path and consider how this dream guides your spiritual evolution. ",
                jewish: "Seek wisdom through study and contemplation, as the tradition teaches about divine messages in dreams. ",
                'multi-faith': "Draw from various spiritual traditions to find the interpretation that resonates most deeply. ",
                spiritual: "Trust your inner wisdom and spiritual intuition to guide you toward understanding. ",
                secular: "Consider the psychological and symbolic meanings that align with your personal growth journey. "
            };
            
            guidance += faithGuidance[spiritualBackground] || faithGuidance.spiritual;
            
            // 基于生活阶段的指导
            const stageGuidance = {
                student: "This is a time for learning and spiritual exploration - remain open to new insights. ",
                'young-adult': "Your spiritual foundation is forming - pay attention to the guidance being offered. ",
                'established-adult': "Use your life experience to discern the deeper meanings and practical applications. ",
                'mature-adult': "Your wisdom and experience provide valuable context for understanding this spiritual message. ",
                retired: "This season of life offers unique opportunities for deep spiritual reflection and growth. ",
                transitioning: "Dreams during transition periods often carry important guidance for your next steps. "
            };
            
            guidance += stageGuidance[lifeStage] || "";
            
            // 基于情绪的指导
            const hasPositiveEmotions = emotions.some(e => ['peaceful', 'joyful', 'hopeful', 'excited'].includes(e));
            const hasNegativeEmotions = emotions.some(e => ['anxious', 'fearful', 'confused', 'sad'].includes(e));
            
            if (hasPositiveEmotions && !hasNegativeEmotions) {
                guidance += "The positive emotions in your dream suggest you're on the right spiritual path - continue with confidence. ";
            } else if (hasNegativeEmotions && !hasPositiveEmotions) {
                guidance += "The challenging emotions indicate areas needing spiritual attention and healing - approach with compassion for yourself. ";
            } else if (hasPositiveEmotions && hasNegativeEmotions) {
                guidance += "The mixed emotions reflect the natural complexity of spiritual growth - embrace both the light and shadow aspects. ";
            }
            
            return guidance;
        }
        
        // 生成推荐行动
        function generateRecommendations(dreamData) {
            const { spiritualBackground, emotions, currentChallenges } = dreamData;
            const recommendations = [];
            
            // 基于信仰背景的推荐
            const faithRecommendations = {
                christian: ["Spend time in prayer and Bible study", "Seek guidance from your faith community"],
                islamic: ["Increase your dhikr and Quran recitation", "Consult with knowledgeable Islamic scholars"],
                buddhist: ["Practice meditation and mindfulness", "Study relevant Buddhist teachings"],
                hindu: ["Engage in yoga and spiritual practices", "Reflect on dharmic principles"],
                jewish: ["Study Torah and seek rabbinical guidance", "Engage in Jewish spiritual practices"],
                'multi-faith': ["Explore teachings from various traditions", "Find common spiritual themes"],
                spiritual: ["Trust your intuition and inner guidance", "Explore spiritual practices that resonate"],
                secular: ["Journal about the dream's personal meaning", "Consider psychological interpretations"]
            };
            
            recommendations.push(...(faithRecommendations[spiritualBackground] || faithRecommendations.spiritual).slice(0, 1));
            
            // 基于情绪的推荐
            if (emotions.includes('anxious') || emotions.includes('fearful')) {
                recommendations.push("Practice calming spiritual techniques like meditation or prayer");
            }
            if (emotions.includes('confused')) {
                recommendations.push("Seek clarity through spiritual study or guidance from mentors");
            }
            if (emotions.includes('joyful') || emotions.includes('hopeful')) {
                recommendations.push("Express gratitude and share your positive spiritual insights");
            }
            
            // 基于生活挑战的推荐
            if (currentChallenges.includes('career')) {
                recommendations.push("Seek spiritual guidance for your professional path");
            }
            if (currentChallenges.includes('relationships')) {
                recommendations.push("Apply spiritual principles to improve your relationships");
            }
            if (currentChallenges.includes('spiritual-growth')) {
                recommendations.push("Dedicate more time to spiritual practices and study");
            }
            
            // 通用推荐
            recommendations.push("Keep a dream journal to track patterns and insights");
            recommendations.push("Share your dream with trusted spiritual advisors or friends");
            
            return recommendations.slice(0, 4); // 限制为4个推荐
        }
        
        // 生成智能信仰视角
        function generateIntelligentFaithPerspective(faith, dreamData) {
            const perspectives = {
                christian: {
                    title: 'Christian Perspective',
                    icon: 'fas fa-cross',
                    content: generateChristianPerspective(dreamData)
                },
                islamic: {
                    title: 'Islamic Perspective',
                    icon: 'fas fa-mosque',
                    content: generateIslamicPerspective(dreamData)
                },
                buddhist: {
                    title: 'Buddhist Perspective',
                    icon: 'fas fa-dharmachakra',
                    content: generateBuddhistPerspective(dreamData)
                },
                hindu: {
                    title: 'Hindu Perspective',
                    icon: 'fas fa-om',
                    content: generateHinduPerspective(dreamData)
                },
                jewish: {
                    title: 'Jewish Perspective',
                    icon: 'fas fa-star-of-david',
                    content: generateJewishPerspective(dreamData)
                },
                universal: {
                    title: 'Universal/Psychological Perspective',
                    icon: 'fas fa-brain',
                    content: generateUniversalPerspective(dreamData)
                }
            };

            const perspective = perspectives[faith];
            return `
                <div class="faith-perspective ${faith} mb-4">
                    <h5 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="${perspective.icon} mr-3"></i>
                        ${perspective.title}
                    </h5>
                    <p class="text-gray-300 leading-relaxed">${perspective.content}</p>
                </div>
            `;
        }
        
        // 各信仰视角的具体生成函数
        function generateChristianPerspective(dreamData) {
            const { emotions, currentChallenges } = dreamData;
            let perspective = "From a Christian viewpoint, this dream may represent God's guidance and communication with you. ";
            
            if (emotions.includes('peaceful') || emotions.includes('joyful')) {
                perspective += "The positive emotions suggest God's peace and blessing upon your path. ";
            }
            if (emotions.includes('anxious') || emotions.includes('fearful')) {
                perspective += "Any anxiety or fear in the dream calls you to trust in God's protection and plan. ";
            }
            
            if (currentChallenges.includes('spiritual-growth')) {
                perspective += "This appears to be a call to deepen your relationship with Christ through prayer and scripture study.";
            } else {
                perspective += "Consider how this dream might be calling you to apply Christian principles in your daily life.";
            }
            
            return perspective;
        }
        
        function generateIslamicPerspective(dreamData) {
            const { emotions, time } = dreamData;
            let perspective = "In Islamic tradition, dreams can be a form of divine communication or spiritual guidance. ";
            
            if (time === 'pre-dawn') {
                perspective += "The timing near Fajr is considered particularly significant for meaningful dreams. ";
            }
            
            if (emotions.includes('peaceful')) {
                perspective += "The peaceful nature suggests this may be a true dream (ru'ya) with positive spiritual meaning. ";
            }
            
            perspective += "Consider making du'a for understanding and reflect on how this guidance applies to your Islamic journey.";
            
            return perspective;
        }
        
        function generateBuddhistPerspective(dreamData) {
            const { emotions } = dreamData;
            let perspective = "From a Buddhist understanding, this dream reflects the nature of consciousness and may indicate karmic patterns or spiritual development. ";
            
            if (emotions.includes('confused')) {
                perspective += "Confusion in dreams often represents the mind's attachment to illusions - practice mindfulness to find clarity. ";
            }
            
            perspective += "The symbols present offer opportunities for developing compassion, wisdom, and understanding of the interconnected nature of existence.";
            
            return perspective;
        }
        
        function generateHinduPerspective(dreamData) {
            const { lifeStage, currentChallenges } = dreamData;
            let perspective = "In Hindu tradition, this dream may relate to your dharmic path and spiritual evolution. ";
            
            if (currentChallenges.includes('life-purpose')) {
                perspective += "The dream appears connected to your search for dharma and life purpose. ";
            }
            
            perspective += `Given your ${lifeStage} life stage, this dream may be guiding you toward the appropriate spiritual practices and life focus for your current ashrama.`;
            
            return perspective;
        }
        
        function generateJewishPerspective(dreamData) {
            const { emotions } = dreamData;
            let perspective = "From a Jewish viewpoint, dreams have been recognized as potential vehicles for divine messages since biblical times. ";
            
            if (emotions.includes('hopeful')) {
                perspective += "The hopeful emotions suggest this may be a dream of encouragement and divine support. ";
            }
            
            perspective += "The Talmudic tradition encourages seeking wise interpretation and considering how this relates to your relationship with the Divine and your role in tikkun olam.";
            
            return perspective;
        }
        
        function generateUniversalPerspective(dreamData) {
            const { emotions, currentChallenges } = dreamData;
            let perspective = "From a universal psychological standpoint, this dream reflects your subconscious processing of life experiences and emotions. ";
            
            if (currentChallenges.length > 0) {
                perspective += `The themes appear connected to your current focus on ${currentChallenges.join(' and ')}, suggesting active psychological integration. `;
            }
            
            perspective += "The symbols and emotions present offer insights into your personal growth, self-understanding, and the integration of conscious and unconscious aspects of your psyche.";
            
            return perspective;
        }

        function getRandomThemes() {
            const themes = ['transformation and growth', 'spiritual awakening', 'inner healing', 'life transitions', 'divine guidance', 'personal empowerment'];
            return themes[Math.floor(Math.random() * themes.length)];
        }

        function getRandomPeriod() {
            const periods = ['significant transformation', 'spiritual awakening', 'inner reflection', 'new beginnings', 'healing and integration'];
            return periods[Math.floor(Math.random() * periods.length)];
        }

        function getRandomGuidance() {
            const guidance = ['trust in your spiritual journey', 'embrace the changes ahead', 'seek deeper spiritual connection', 'focus on inner healing', 'remain open to divine guidance'];
            return guidance[Math.floor(Math.random() * guidance.length)];
        }

        function getRandomPractice() {
            const practices = ['meditation and prayer', 'journaling and reflection', 'spiritual study', 'acts of service', 'mindfulness practice'];
            return practices[Math.floor(Math.random() * practices.length)];
        }

        function startOver() {
            // Reset form
            document.getElementById('dreamAnalysisForm').reset();
            
            // Go back to step 1
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            document.getElementById('step1').classList.remove('hidden');
            
            // Reset step indicators
            updateStepIndicators(1);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dreamDate').value = today;
            
            // 延迟更新按钮状态，确保auth.js已加载
            setTimeout(function() {
                updateAnalysisButton();
            }, 100);
            
            // 监听登录状态变化
            document.addEventListener('userLoggedIn', updateAnalysisButton);
            document.addEventListener('userLoggedOut', updateAnalysisButton);
            window.addEventListener('storage', function(e) {
                if (e.key === 'dreamwise_token') {
                    updateAnalysisButton();
                }
            });
            
            // 定期检查按钮状态（防止初始化问题）
            const checkButtonInterval = setInterval(function() {
                updateAnalysisButton();
            }, 1000);
            
            // 5秒后停止定期检查
            setTimeout(function() {
                clearInterval(checkButtonInterval);
            }, 5000);
        });
        
        // 更新分析按钮状态
        function updateAnalysisButton() {
            const button = document.getElementById('generateAnalysisBtn');
            const buttonText = document.getElementById('analysisButtonText');
            const buttonIcon = document.getElementById('analysisButtonIcon');
            
            if (!button || !buttonText || !buttonIcon) {
                console.log('Button elements not found, retrying...');
                return;
            }
            
            const isAuthenticated = isUserAuthenticated();
            console.log('Updating button state, authenticated:', isAuthenticated);
            
            if (isAuthenticated) {
                // 已登录状态
                buttonText.textContent = 'Generate Analysis';
                buttonIcon.className = 'fas fa-magic ml-2';
                button.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%)';
                button.onmouseover = function() {
                    this.style.background = 'linear-gradient(135deg, #7c3aed 0%, #db2777 100%)';
                };
                button.onmouseout = function() {
                    this.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%)';
                };
                console.log('Button updated to authenticated state');
            } else {
                // 未登录状态
                buttonText.textContent = 'Sign In to Generate Analysis';
                buttonIcon.className = 'fas fa-sign-in-alt ml-2';
                button.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
                button.onmouseover = function() {
                    this.style.background = 'linear-gradient(135deg, #2563eb 0%, #1e40af 100%)';
                };
                button.onmouseout = function() {
                    this.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
                };
                console.log('Button updated to unauthenticated state');
            }
        }
    </script>

<script>
// 页面加载完成后移除初始隐藏
document.addEventListener('DOMContentLoaded', function() {
  // 确保所有关键资源已加载
  setTimeout(function() {
    document.body.classList.add('loaded');
  }, 100);
});
</script>

    <!-- Authentication System - 移到页面底部但在其他脚本之前 -->
    <script src="../assets/js/auth.js"></script>
</body></html>